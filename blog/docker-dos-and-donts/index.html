<!doctype html>
<html>
<head>
  <meta charset='utf-8'/>
  <meta name='viewport' content='width=device-width, initial-scale=1'/>

  <title>Docker Do&#39;s And Don&#39;ts | devo.ps</title>

  <meta http-equiv='Content-Language' content='en'/>
  <meta name='keywords' content='devo.ps, DevOps, Cloud, servers, git, API, infrastructure, automation, Continuous Integration, Continuous Deployment, Configuration Management, Orchestration, System Administration, PaaS, IaaS, Docker, best-practices'/>
  <meta name='description' content='Dealing with servers doesn&#39;t have to be a pain: manage and automate all your servers with a few Git commands on any cloud, from Digital Ocean to AWS.'/>
  <meta name='msvalidate.01' content='86C1F235D57610586CFC5A2D77B7D446'/>
  <meta http-equiv='Content-Language' content='en'/>
  
  <!-- Favicons -->
  <link rel='shortcut icon' href='/assets/favicon.ico'>
<link rel='apple-touch-icon' sizes='57x57' href='/assets/favicons/apple-touch-icon-57x57.png'>
<link rel='apple-touch-icon' sizes='114x114' href='/assets/favicons/apple-touch-icon-114x114.png'>
<link rel='apple-touch-icon' sizes='72x72' href='/assets/favicons/apple-touch-icon-72x72.png'>
<link rel='apple-touch-icon' sizes='144x144' href='/assets/favicons/apple-touch-icon-144x144.png'>
<link rel='apple-touch-icon' sizes='60x60' href='/assets/favicons/apple-touch-icon-60x60.png'>
<link rel='apple-touch-icon' sizes='120x120' href='/assets/favicons/apple-touch-icon-120x120.png'>
<link rel='apple-touch-icon' sizes='76x76' href='/assets/favicons/apple-touch-icon-76x76.png'>
<link rel='apple-touch-icon' sizes='152x152' href='/assets/favicons/apple-touch-icon-152x152.png'>
<link rel='icon' type='image/png' href='/assets/favicons/favicon-196x196.png' sizes='196x196'>
<link rel='icon' type='image/png' href='/assets/favicons/favicon-160x160.png' sizes='160x160'>
<link rel='icon' type='image/png' href='/assets/favicons/favicon-96x96.png' sizes='96x96'>
<link rel='icon' type='image/png' href='/assets/favicons/favicon-16x16.png' sizes='16x16'>
<link rel='icon' type='image/png' href='/assets/favicons/favicon-32x32.png' sizes='32x32'>
<meta name='msapplication-TileColor' content='#da532c'>
<meta name='msapplication-TileImage' content='/assets/favicons/mstile-144x144.png'>
<meta name='msapplication-config' content='/assets/favicons/browserconfig.xml'>

  <!-- CSS -->
  <link href='/assets/styles.css?20140921' rel='stylesheet' type='text/css'/>
</head>
<body class='page-blog/docker-dos-and-donts'>
  <header id='header'>
    <div class='wrapper'>
      <a href='/' class='logo'>devo.ps</a>

      <button class='toggle'>Menu</button>
      <nav class='menu'>
        <a href='https://www.hipchat.com/gyHEHtsXZ' target='_blank'>Chat with us</a>
        <a href='/pricing'>Pricing</a>
        <a href='http://app.devo.ps' class='signin'>Sign in</a>
      </nav>
    </div>
  </header>

  
<section id='main' class='blog post'>
  <div class='wrapper'>
    <header class='header'>
      <a href='/blog' class='back'><span>Back to the blog</span></a>

      <h1>Docker Do&#39;s And Don&#39;ts</h1>

      <span class='meta'>
        
        
        
        
        
        
        
        
        
        
          <img class='avatar' alt='Vincent Viallet' src='/images/team/vincent-small.png'/> 
          Vincent Viallet
        
        
        
        
        on <time datetime=''>August 26, 2014</time>
      </span>
    </header>

    <article class='content'>
      <script async class='speakerdeck-embed' data-id='9b9300600cbe01326b873a4a8db3af3a' data-ratio='1.33333333333333' src='//speakerdeck.com/assets/embed.js'></script>

<p>I gave a short (last minute) presentation at the <a href="http://www.meetup.com/Docker-Shanghai/events/197476672/">Shanghai Docker meetup last Saturday</a> at VMware&#39;s office. We talked about how experience using Docker while building <a href="http://devo.ps">devo.ps</a> and gave some basic advices as to what to do (and what not to).</p>
<h2 id="why-we-chose-docker-">Why we chose Docker?</h2>
<ul>
<li><strong>Separation of concerns and Scalability</strong>: devo.ps is a complex system. We want to isolate features as micro-services and be able, down the road, to easily scale horizontally.</li>
<li><strong>Deployment cycles</strong>: since we&#39;re dealing with a complex stack, the ability to update parts of the systems independently was a huge plus.</li>
</ul>
<h2 id="how-we-use-docker-">How we use Docker?</h2>
<ul>
<li><strong>Bus-centric architecture</strong>: we basically have RabbitMQ tying up a lot of micro-services.</li>
<li><strong>Non-ephemeral containers</strong>: we actually treat containers more like VMs with fairly long life-cycles.</li>
</ul>
<h2 id="the-don-ts">The don&#39;ts</h2>
<ul>
<li><strong>Don&#39;t rush into building your own tools</strong>: if you hit a wall, others probably have. GitHub and #docker on IRC (@freenode) are your friends; ask around and make sure you&#39;re not building something already solved. For example, <a href="http://wiredcraft.com/posts/2014/07/30/dns-and-docker- containers.html">we used our DIY DNS management approach</a> until the recent etcd update.</li>
<li><strong>If you do write your own tools, don&#39;t go crazy</strong>: keep if light and simple. Docker is moving extremely fast, your work may become obsolete next week. It happened to us with containers orchestration; we wrote our own tool which became useless 2 weeks later.</li>
<li><strong>Don&#39;t think Docker will solve all your (DevOps) problems</strong>: Docker is just another tool, it adds a layer of complexity, it isn&#39;t pixie dust. Use containers for what it&#39;s good at, not because it&#39;s the new hot thing.</li>
</ul>
<h2 id="the-do-s">The do&#39;s</h2>
<ul>
<li><strong>Use caching properly for your Dockerfiles</strong>: docker containers are built very quickly as long as you make use of the caching capability. A quick set of gotchas and advices:<ul>
<li><code>ADD</code> &amp; <code>VOLUMES</code> are cache invalidators. </li>
<li><code>RUN</code> commands are cached while unchanged. </li>
<li>Dockerfile execution is sequential, hence: order matters and a changed step deprecate the next caches. </li>
<li>Group your <code>RUN</code> commands (shell sequences) together per type (e.g. ssh related). This allows you to tune and forget a &quot;feature&quot; of your container and focus on the next one without ever blowing up your cache.</li>
<li>Maintain common command orders in between your various Dockerfiles. This allow to use &quot;common&quot; caching from one container to another for as long as they share common features</li>
</ul>
</li>
<li><strong>Maintain your containers in a registry</strong>: it lets you deploy quickly, revert quickly and have matching versions of your containers. Same thing apply for your Dockerfiles: use a VCS. See  <a href="http://blog.docker.com/2013/07/how-to-use-your-own-registry/">http://blog.docker.com/2013/07/how-to-use-your-own-registry/</a>,
<a href="https://github.com/docker/docker-registry">Docker registry</a> &amp; <a href="https://hub.docker.com/">Docker hub</a>.</li>
<li><strong>Plan your containers life-cycles</strong>: if you are using Docker for computing purpose this may not be critical, but if you intend on having long-running containers it is absolutely required. Among other things:<ul>
<li>Define what data are persistent, ephemeral or shared.</li>
<li>Define the best fit between named or anonymous volumes or devices (LVM / disks). See for example <a href="http://wiredcraft.com/posts/2014/06/25/ data_migration_of_named_docker_containers.html">our take on data migration of named docker containers</a>.</li>
<li>How will your data be loaded? Does it need to be prepared at run time? Does it have proper permissions/ownership?</li>
</ul>
</li>
<li><strong>Log all the things</strong>: this seems easy with stdout/err on a few containers, but quickly become complex once you start adding up containers or when you start running services that do not puke their logs on the console. We use a combination of syslog, <a href="logio.org">log.io</a>, <a href="http://logstash.net/">logstash</a> and <a href="https://rashidkpc.github.io/Kibana/">Kibana</a>.</li>
<li><strong>Define a proper start logic</strong>: containers are not servers, the start workflow is different:<ul>
<li>there are no init scripts on containers.</li>
<li>1 container = 1 exec on start, if the command exit, the container stops, use <code>run</code> scripts when needed,</li>
<li>supervisord lets you manage your services <em>ala</em> init (hurray!).</li>
</ul>
</li>
</ul>
<h2 id="a-few-more-things">A few more things</h2>
<ul>
<li><a href="https://github.com/ClusterHQ/flocker">Flocker</a>: lets you manage a fleet of containers and handle data migration.</li>
<li><a href="https://github.com/signalfuse/maestro-ng">Maestro-ng</a>: containers management.</li>
<li><strong>Using docker for safe or multi-tenancy execution</strong>: safely executing arbitrary code or multiple applications on the same machine. That&#39;s actually what we&#39;re doing with <a href="http://chato.ps">one of our side projects</a>.</li>
</ul>

      
      <footer class='share'>
        

<a class='email' href='mailto:?body=http%3A%2F%2Fdevo.ps%2Fblog%2Fdocker-dos-and-donts'><span>Share by email</span></a>
<a class='facebook' target='_blank' href='https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fdevo.ps%2Fblog%2Fdocker-dos-and-donts'><span>Share on facebook</span></a>
<a class='twitter' target='_blank' href='https://twitter.com/intent/tweet?text=@devo_ps%20&related=devo_ps&url=http%3A%2F%2Fdevo.ps%2Fblog%2Fdocker-dos-and-donts'><span>Share on Twitter</span></a>
<a class='google' target='_blank' href='https://plus.google.com/share?url=http%3A%2F%2Fdevo.ps%2Fblog%2Fdocker-dos-and-donts'><span>Share on Google+</span></a>
<a class='linkedin' target='_blank' href='http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Fdevo.ps%2Fblog%2Fdocker-dos-and-donts&title=Docker%20Do&#39;s%20And%20Don&#39;ts&source=devo.ps'><span>Share on LinkedIn</span></a>

      </footer>

      <footer class='subscribe'>
        <h2>Like what you just read?</h2>
        <p>Leave us your email address and we'll shoot you an email once in a while to share new content. We mostly write about development, infrastructure and DevOps.</p>
        <form action='http://wiredcraft.us2.list-manage1.com/subscribe/post?u=18eb8d6c34ad5d4e781541da9&amp;id=db875395f9' method='post' target='_blank'>
  <div class='field'>
    <input type='email' value='' name='EMAIL' class='required email' placeholder='Your email address'/>
  </div>
  <div class='field'>
    <input type='submit' value='Subscribe' name='subscribe' class='button'/>
  </div>
</form>
        <p>You can also <a href='http://feeds.feedburner.com/devo/BQLM' class='rss'>Subscribe to our RSS feed</a>.</p>
      </footer>

      <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'devo-ps'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </section>
  </div>
</section>


  <nav id='footer'>
    <div class='wrapper'>
      <nav class='product'>
        <h3>Product</h3>
        <a href='/#pricing'>Pricing</a>
        <a href='http://github.com/devops-community'>Community</a>
        <!-- <a href='/features'>Features</a> -->
      </nav>
      <nav class='help'>
        <h3>Help</h3>
        <a class='chat' href='https://www.hipchat.com/gyHEHtsXZ' target='_blank'>Chat with us</a>
        <a class='documentation' href='http://docs.devo.ps' target='_blank'>Documentation</a>
        <a class='help' href='mailto:help@devo.ps' target='_blank'>Support</a>
      </nav>
      <nav class='company'>
        <h3>Company</h3>
        <a href='/about'>About</a>
        <a href='/blog'>Blog</a>
        <a href='http://twitter.com/devo_ps' target='_blank'>Twitter</a>
      </nav>
      <aside class='subscribe'>
        <h3>Subscribe to our newsletter</h3>
        <form action='http://wiredcraft.us2.list-manage1.com/subscribe/post?u=18eb8d6c34ad5d4e781541da9&amp;id=db875395f9' method='post' target='_blank'>
  <div class='field'>
    <input type='email' value='' name='EMAIL' class='required email' placeholder='Your email address'/>
  </div>
  <div class='field'>
    <input type='submit' value='Subscribe' name='subscribe' class='button'/>
  </div>
</form>
      </aside>
      <small class='legal'>
        Copyright © 2014 Wiredcraft Co. Ltd. <a href='/privacy'>Privacy</a> <a href='/tos'>Terms of Service</a>
      </small>
    </div>
  </nav>

  <div id='overlay'>
    <div id='modal'></div>
  </div>

  <!-- JS -->
  <script src='/assets/scripts.js' type='text/javascript'></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <!--[if lt IE 9]><script src='http://html5shim.googlecode.com/svn/trunk/html5.js'></script><![endif]-->
  <script type='text/javascript'>
  var _gauges = _gauges || [];
  (function() {
    var t   = document.createElement('script');
    t.type  = 'text/javascript';
    t.async = true;
    t.id    = 'gauges-tracker';
    t.setAttribute('data-site-id', '510b396a613f5d2666000007');
    t.src = '//secure.gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>
	<script type='text/javascript'>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34006371-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</body>
</html>
