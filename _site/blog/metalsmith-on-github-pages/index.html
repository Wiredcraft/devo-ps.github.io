<!doctype html>
<html>
<head>
  <meta charset='utf-8'/>
  <meta name='viewport' content='width=device-width, initial-scale=1'/>

  <title>Metalsmith On GitHub pages | devo.ps</title>

  <meta http-equiv='Content-Language' content='en'/>
  <meta name='keywords' content='devo.ps, DevOps, Cloud, servers, git, API, infrastructure, automation, Continuous Integration, Continuous Deployment, Configuration Management, Orchestration, System Administration, PaaS, IaaS, continuous integration, continuous delivery, continuous deployment, metalsmith, Node.js, GitHub, GitHub pages'/>
  <meta name='description' content='Dealing with servers doesn&#39;t have to be a pain: manage and automate all your servers with a few Git commands on any cloud, from Digital Ocean to AWS.'/>
  <meta name='msvalidate.01' content='86C1F235D57610586CFC5A2D77B7D446'/>
  <meta http-equiv='Content-Language' content='en'/>
  
  <!-- Favicons -->
  <link rel='shortcut icon' href='/assets/favicon.ico'>
<link rel='apple-touch-icon' sizes='57x57' href='/assets/favicons/apple-touch-icon-57x57.png'>
<link rel='apple-touch-icon' sizes='114x114' href='/assets/favicons/apple-touch-icon-114x114.png'>
<link rel='apple-touch-icon' sizes='72x72' href='/assets/favicons/apple-touch-icon-72x72.png'>
<link rel='apple-touch-icon' sizes='144x144' href='/assets/favicons/apple-touch-icon-144x144.png'>
<link rel='apple-touch-icon' sizes='60x60' href='/assets/favicons/apple-touch-icon-60x60.png'>
<link rel='apple-touch-icon' sizes='120x120' href='/assets/favicons/apple-touch-icon-120x120.png'>
<link rel='apple-touch-icon' sizes='76x76' href='/assets/favicons/apple-touch-icon-76x76.png'>
<link rel='apple-touch-icon' sizes='152x152' href='/assets/favicons/apple-touch-icon-152x152.png'>
<link rel='icon' type='image/png' href='/assets/favicons/favicon-196x196.png' sizes='196x196'>
<link rel='icon' type='image/png' href='/assets/favicons/favicon-160x160.png' sizes='160x160'>
<link rel='icon' type='image/png' href='/assets/favicons/favicon-96x96.png' sizes='96x96'>
<link rel='icon' type='image/png' href='/assets/favicons/favicon-16x16.png' sizes='16x16'>
<link rel='icon' type='image/png' href='/assets/favicons/favicon-32x32.png' sizes='32x32'>
<meta name='msapplication-TileColor' content='#da532c'>
<meta name='msapplication-TileImage' content='/assets/favicons/mstile-144x144.png'>
<meta name='msapplication-config' content='/assets/favicons/browserconfig.xml'>

  <!-- CSS -->
  <link href='/assets/styles.css?20140920' rel='stylesheet' type='text/css'/>
</head>
<body class='page-blog/metalsmith-on-github-pages'>
  <header id='header'>
    <div class='wrapper'>
      <a href='/' class='logo'>devo.ps</a>

      <button class='toggle'>Menu</button>
      <nav class='menu'>
        <a href='https://www.hipchat.com/gyHEHtsXZ' target='_blank'>Chat with us</a>
        <a href='/pricing'>Pricing</a>
        <a href='http://app.devo.ps' class='signin'>Sign in</a>
      </nav>
    </div>
  </header>

  
<section id='main' class='blog post'>
  <div class='wrapper'>
    <header class='header'>
      <a href='/blog' class='back'><span>Back to the blog</span></a>

      <h1>Metalsmith On GitHub pages</h1>

      <span class='meta'>
        
        
        
        
        
        
        
        
          <img class='avatar' alt='Ronan Berder' src='/images/team/ronan-small.png'/> 
          Ronan Berder
        
        
        
        
        
        
        on <time datetime=''>September 05, 2014</time>
      </span>
    </header>

    <article class='content'>
      <p>We love GitHub pages and use it more than we probably should: our <a href="http://devo.ps">main website (devo.ps)</a> and <a href="http://docs.devo.ps">documentation</a> are actually GitHub pages. We use <a href="https://swiftype.com/">SwiftType</a> to provide search on the documentation, but otherwise these are pretty regular static websites. However, we don&#39;t use Jekyll; our team is more at ease with nNde.js than Ruby, which is why we usually prefer it <a href="http://www.metalsmith.io/">Metalsmith</a>. And since we&#39;re pretty lazy, we automate building and pushing to the <code>gh-pages</code> using <a href="http://devo.ps">devo.ps</a> (of course). Here&#39;s what it looks like.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>You&#39;ll need to have a few things in place already:</p>
<ul>
<li><p>A repo with <a href="https://pages.github.com/">GitHub pages</a> activated (duh). We&#39;ll assume you&#39;re using the <code>gh-pages</code> branch, though if it is your <code>*.github.io</code> repo it should be <code>master</code>.</p>
<p>  <img src="http://devo.ps/images/posts/github-pages-settings.png" alt="GitHub pages settings"/></p>
</li>
<li><p>A <a href="http:/app.devo.ps/">devo.ps account</a> (it&#39;s free) with (for the sake of this example) your Digital Ocean account tied up to it (though you could use AWS, Rackspace or Linode with minimum changes).</p>
</li>
<li><p>A <a href="http://">Metalsmith</a> site that has a Makefile along with a <code>make build</code> command (in our example we use it to install the npm dependencies as well as run bower and gulp).</p>
</li>
</ul>
<h2 id="let-s-get-started">Let&#39;s get started</h2>
<p>We&#39;ll be going through it step by step: I&#39;ll most likely prepare a repo very soon for you to fork, using our brand new <a href="http://devo.ps/blog/one-click-deploy-of-your-infrastructure/">devo.ps button</a> feature.</p>
<ol>
<li><p><a href="http://docs.devo.ps/how-to/add-a-node/">Add a server</a> (either to a new repo or an existing one) or use an existing node with the following services/configuration:</p>
<pre><code> id: build-server
 name: Build server
 type: server

 provider:
   name: digitalocean
   size: 66

 services:
   nodejs: *

 configuration:
   nodejs:
     packages:
       - bower
       - gulp
</code></pre></li>
<li><p>Once you&#39;ve added your server, copy its public SSH key from the details section:</p>
<p> <img src="http://devo.ps/images/posts/devops-ssh-key.png" alt="GitHub pages settings"/></p>
</li>
<li><p>Add that key as a deploy key in the settings of your site&#39;s repo on GitHub:</p>
<p> <img src="http://devo.ps/images/posts/github-deploy-keys.png" alt="GitHub deploy key"/></p>
</li>
<li><p>We&#39;ll then add a task on devo.ps to do the bulk of the job:</p>
<pre><code> type: task
 id: gh-pages-build
 name: Build and deploy on gh-pages

 vars:
   # Feel free to edit the following values to match your use case
   dir: /opt/example.com
   build: _site
   temp: /tmp/build
   # You&#39;ll need to change that to match the Git URL of your site&#39;s repo
   repo: git@github.com:my-account/my-repo.git
   # We&#39;re here assuming we work out of the metalsmith branch
   ref: refs/heads/metalsmith
   dest: gh-pages

 targets:
   - build-server

 triggers:
   webhooks:
     - path: XkYw58l2d7rehq2Dkh4Nmd

 steps:
   # Hack to ensure we&#39;re building only when the right branch is updated
   - run: if [ &quot;{{ trigger.payload.ref }}&quot; != &quot;{{ ref }}&quot; ]; then echo &quot;Wrong branch&quot; &gt;&amp;2 ; exit 1 ; fi

   # Fetch our updates
   - run: devops git update
     options:
       repo: &quot;{{ repo }}&quot;
       dest: &quot;{{ dir }}&quot;
       version: metalsmith

   # Build the site
   - run: cd {{ dir }} &amp;&amp; make build &amp;&amp; git stash save

   # We copy the result of our build over to a temporary folder
   - run: rm -Rf {{ temp }} &amp;&amp; cd {{ dir }} &amp;&amp; cp -a {{ build }} {{ temp }}

   # We switch to `gh-pages` and trash its content
   - run: cd {{ dir }} &amp;&amp; git checkout {{ dest }} &amp;&amp; git rm -r --ignore-unmatch * 

   # We copy back the build in the Git repo
   - run: cd {{ dir }} &amp;&amp; cp -a {{ temp }}/* .

   # We push our changes back
   - run: &gt; 
       cd {{ dir }} &amp;&amp; 
       git add . &amp;&amp; 
       git commit -am &quot;Build triggered by commit {{ trigger.payload.after }} from {{ trigger.payload.head_commit.author.username }}&quot; &amp;&amp; 
       git push origin {{ dest }}
</code></pre></li>
<li><p>Once that task is saved, we still need to point GitHub&#39;s webhook at it. You&#39;ll notice we added a <code>path: XkYw58l2d7rehq2Dkh4Nmd</code> in the <code>webhooks</code> section of the <code>triggers</code> attribute. It means that your task can be triggered by hitting the <code>https://wh.devo.ps/{USER}/{REPO}/XkYw58l2d7rehq2Dkh4Nmd</code> URL, where <code>{USER}</code> and <code>{REPO}</code> are your devo.ps username and repository name for this task. Go ahead and add this on GitHub in the &quot;Webhooks &amp; Services&quot; settings page:</p>
<p> <img src="http://devo.ps/images/posts/github-webhook.png" alt="GitHub webhook"/></p>
</li>
<li><p>Voil√†!</p>
</li>
</ol>
<p>Every time you&#39;ll be pushing a new commit on the <code>metalsmith</code> branch, devo.ps will fetch the changes, build the site and push it back in the <code>gh-pages</code> branch. Keep in mind that GitHub pages are public, wether or not the repo is.</p>
<p>There are obviously still a few rough edges: it&#39;d be nice not to have to configure things manually on GitHub, it also would be nice to be able to not rely on a trick to prevent the task from running when the commit isn&#39;t related to the <code>metalsmith</code> branch.</p>
<p>In the next couple weeks, we&#39;ll be adding some of these features and starting to integrate more tightly with GitHub.</p>

      
      <h2 class='feedback'>Have some feedback? Let us know on <a href='https://twitter.com/intent/tweet?text=@devo_ps%20&related=devo_ps&url=http://devo.ps/blog/metalsmith-on-github-pages' target='_blank'>Twitter</a>.</h2>

      <footer class='more'>
        <section class='pitch'>
  <h3>Manage servers with Git</h3>
  <p>Managing servers doesn't have to be painful: start using Git to control any cloud from Digital Ocean to AWS.</p>
<a href='https://app.devo.ps' class='button add'>Try it for <strong>free</strong></a>
<small>Already have an account? <a href='https://app.devo.ps'>Sign in</a>.</small>
</section>

<section class='subscribe'>
  <h3>Stay tuned</h3>
  <ul>
    <li class='newsletter'><form action='http://wiredcraft.us2.list-manage1.com/subscribe/post?u=18eb8d6c34ad5d4e781541da9&amp;id=db875395f9' method='post' target='_blank'>
  <div class='field'>
    <input type='email' value='' name='EMAIL' class='required email' placeholder='Your email address'/>
  </div>
  <div class='field'>
    <input type='submit' value='Subscribe' name='subscribe' class='button'/>
  </div>
</form></li>
    <li class='twitter'><a href='http://twitter.com/devo_ps'>Follow us on twitter</a></li>
    <li class='rss'><a href='http://feeds.feedburner.com/devo/BQLM'>RSS feed</a></li>
  </ul>
</section>

      </footer>

      <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'devo-ps'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </section>
  </div>
</section>


  <nav id='footer'>
    <div class='wrapper'>
      <nav class='product'>
        <h3>Product</h3>
        <a href='/#pricing'>Pricing</a>
        <a href='http://github.com/devops-community'>Community</a>
        <!-- <a href='/features'>Features</a> -->
      </nav>
      <nav class='help'>
        <h3>Help</h3>
        <a class='chat' href='https://www.hipchat.com/gyHEHtsXZ' target='_blank'>Chat with us</a>
        <a class='documentation' href='http://docs.devo.ps' target='_blank'>Documentation</a>
        <a class='help' href='mailto:help@devo.ps' target='_blank'>Support</a>
      </nav>
      <nav class='company'>
        <h3>Company</h3>
        <a href='/about'>About</a>
        <a href='/blog'>Blog</a>
        <a href='http://twitter.com/devo_ps' target='_blank'>Twitter</a>
      </nav>
      <aside class='subscribe'>
        <h3>Subscribe to our newsletter</h3>
        <form action='http://wiredcraft.us2.list-manage1.com/subscribe/post?u=18eb8d6c34ad5d4e781541da9&amp;id=db875395f9' method='post' target='_blank'>
  <div class='field'>
    <input type='email' value='' name='EMAIL' class='required email' placeholder='Your email address'/>
  </div>
  <div class='field'>
    <input type='submit' value='Subscribe' name='subscribe' class='button'/>
  </div>
</form>
      </aside>
      <small class='legal'>
        Copyright ¬© 2014 Wiredcraft Co. Ltd. <a href='/privacy'>Privacy</a> <a href='/tos'>Terms of Service</a>
      </small>
    </div>
  </nav>

  <div id='overlay'>
    <div id='modal'></div>
  </div>

  <!-- JS -->
  <script src='/assets/scripts.js' type='text/javascript'></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <!--[if lt IE 9]><script src='http://html5shim.googlecode.com/svn/trunk/html5.js'></script><![endif]-->
  <script type='text/javascript'>
  var _gauges = _gauges || [];
  (function() {
    var t   = document.createElement('script');
    t.type  = 'text/javascript';
    t.async = true;
    t.id    = 'gauges-tracker';
    t.setAttribute('data-site-id', '510b396a613f5d2666000007');
    t.src = '//secure.gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>
	<script type='text/javascript'>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34006371-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</body>
</html>
